---
title: "Dataselectie Slak-in-Du kust"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output: 
  
  html_document:
      code_folding: hide
      toc: true
      toc_float: true
      toc_collapsed: true
  editor_options:
      chunk_output_type: console
---

```{r setup, include=FALSE}
library(knitr)
library(here)
opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE
)
opts_knit$set(root.dir = here::here())

library(tidyverse)
library(gridExtra)
library(sf)
library(mapview)
```

# Doel

Selectie van de observaties die gebruikt zullen in het eindrapport van Slak-in-Du aan de kust.


# Data inlezen

We lezen de volgende kaarten in: 

- Slak-in-Dugebied aan de kust

Deze bevat twee ecoregio's. We voegen deze samen zodat we een enkele kaart hebben van het volledige studiegebied. 

```{r}
# Locatie van data en output mappen
data_path <- here("data", "raw")
out_path <- here("data", "processed")

# Lees kaartlagen in
studiegebied_kust <- st_read(paste(out_path, "studiegebied_kust.shp", 
                                   sep = "/"))

# Voeg ecoregio's samen tot één studiegebied
studiegebied_kust_merged <- studiegebied_kust %>%
  st_buffer(0.5) %>%
  st_union()

# Referentie coordinatensysteem: UTM zone 31N
proj_crs <- 32631
```

Visualisatie van de kaartlagen:

```{r}
# Maak thema voor plotten van kaartjes
mytheme <- theme(panel.grid.major = element_line(color = "grey", 
                                                 linetype = "dashed", 
                                                 size = 0.3),
                 panel.background = element_rect(fill = "aliceblue"),
                 axis.title = element_blank())

# Plot kaarten
studiegebied_kust_merged %>%
  ggplot() +
    geom_sf(fill = "white") +
    mytheme
```

We lezen de waarnemingendata in van Slak-in-Du. We trekken een buffer rond elke waarneming van 25 m.

```{r}
# Laad data
slakken_data <- read_csv(paste(data_path, "observations-slak-in-du.csv",
                               sep = "/"))

# Zet om naar sf object
slakken_data_sf <- slakken_data %>% 
  st_as_sf(coords = c("lng", "lat"), crs = 4326)

# Zet crs om naar project crs
slakken_data_sf <- slakken_data_sf %>%
  st_transform(crs = proj_crs)

# Voeg buffer toe van 25 m radius
slakken_data_sf_buffer <- slakken_data_sf %>%
  st_buffer(25)
```

# Data selectie

We selecteren daarna de waarnemingen binnen het studiegebied aan de kust.

```{r}
# Selectie waarnemingen binnen studiegebied
slakken_kust <- slakken_data_sf_buffer %>%
  st_intersection(studiegebied_kust_merged)
```

Zijn er punten die vlak buiten het gebied vallen, maar die wel van belang zijn?

```{r}
# Selecteer correcte observaties binnen gebied als punten
correct_obs <- slakken_data_sf %>% 
  st_intersection(studiegebied_kust_merged)
id_correct_obs <- correct_obs$id

# Selecteer observaties net buiten gebied
net_erbuiten <- slakken_data_sf %>% 
  st_crop(xmin = 460000, xmax = 530000,
          ymin = 5640000, ymax = 5700000) %>%
  filter(!(id %in% id_correct_obs))

# Visualiseer
mapview(correct_obs, col.regions = "red") +
  mapview(net_erbuiten, col.regions = "blue") +
  mapview(studiegebied_kust_merged, col.regions = "white")
```



# Data exploratie

